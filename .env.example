# ============================================
# CONFIGURACIÓN DEL TRADING BOT - ÍNDICES SINTÉTICOS
# ============================================
# Copia este archivo a .env y completa los valores requeridos

# ==================== TELEGRAM ====================
# Token del bot de Telegram (obtener de @BotFather)
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# ID del canal de Telegram (puede ser @nombre_canal o -1001234567890)
TELEGRAM_CHANNEL_ID=@tu_canal_trading

# Incluir gráficos en las notificaciones (true/false)
TELEGRAM_INCLUDE_CHARTS=true

# ==================== METATRADER 5 ====================
# Credenciales de la cuenta MT5
MT5_LOGIN=12345678
MT5_PASSWORD=tu_contraseña_mt5
MT5_SERVER=Weltrade-Demo

# Ruta de instalación de MT5 (dejar vacío para auto-detectar en Windows)
MT5_PATH=

# Número mágico para identificar las operaciones del bot
MT5_MAGIC_NUMBER=234000

# Activar trading automático (true/false)
# ADVERTENCIA: false = solo notificaciones, true = ejecuta trades reales
MT5_AUTO_TRADING=true

# Tamaño de lote base (usado como fallback o si el lotaje dinámico está desactivado)
MT5_LOT_SIZE=0.30

# Máximo de posiciones abiertas simultáneamente
MT5_MAX_OPEN_POSITIONS=20

# ==================== TRADING ====================
# Símbolos a operar (separados por coma, entre comillas si hay espacios)
# Todos los índices sintéticos disponibles
TRADING_SYMBOLS="PainX 400,GainX 400,PainX 600,GainX 600,PainX 800,GainX 800,PainX 999,GainX 999,PainX 1200,GainX 1200"

# Timeframes a analizar (separados por coma)
# Valores válidos: 1m, 5m, 15m, 1h, 4h, 1d
TIMEFRAMES="1m,5m,15m,1h,4h,1d"

# Timeframe principal para operar (debe estar incluido en TIMEFRAMES)
# Este será el timeframe usado para generar las señales de trading
# Los demás timeframes sirven para confirmación
# Valores válidos: 1m, 5m, 15m, 1h, 4h, 1d
PRIMARY_TIMEFRAME="15m"

# ==================== IA Y SEÑALES ====================
# Umbral de confianza mínimo para generar señales (0.0 - 1.0)
# Valores recomendados: 0.50 = más señales, 0.75 = señales más selectivas
# OPCIÓN 2 (Conservadora): 0.80 para máxima calidad
CONFIDENCE_THRESHOLD=0.80

# Número de velas de contexto para análisis de mercado
# El bot analiza este número de velas históricas para generar señales
# Valores recomendados: 1000-2000 velas para mayor contexto y análisis de calidad
# NOTA: Valores más altos = mejor contexto histórico pero mayor uso de memoria
MARKET_ANALYSIS_CANDLES=2000

# ==================== GESTIÓN DE RIESGOS ====================
# Período para calcular el ATR (Average True Range)
ATR_PERIOD=14

# Límites de señales
MAX_SIGNALS_PER_DAY=30
MAX_SIGNALS_PER_PAIR=5

# --- MODO DINÁMICO (Recomendado) ---
# El SL/TP se calcula automáticamente basado en el ATR del mercado
# Se adapta a la volatilidad: mercados volátiles = SL/TP más amplios
ENABLE_DYNAMIC_RISK=true

# Multiplicadores de ATR para Stop Loss y Take Profit (solo si ENABLE_DYNAMIC_RISK=true)
# OPTIMIZADO PARA RENTABILIDAD: Risk/Reward Ratio = 2.5:1 (3.0/1.2)
# Con este R:R, solo necesitas 29% win rate para break-even (vs 43% con R:R 1.33:1)
# Valores anteriores: SL=1.5, TP1=2.0, TP2=4.0 (R:R 1.33:1 - NO rentable)
# Valores nuevos: SL=1.2, TP1=3.0, TP2=6.0 (R:R 2.5:1 - RENTABLE con 40%+ win rate)
STOP_LOSS_ATR_MULTIPLIER=1.2
TAKE_PROFIT_1_ATR_MULTIPLIER=3.0
TAKE_PROFIT_2_ATR_MULTIPLIER=6.0

# --- MODO FIJO (Para backtesting o control manual) ---
# Descomenta las siguientes líneas para usar valores fijos en PUNTOS
#
# IMPORTANTE - CÁLCULO DE PUNTOS PARA ÍNDICES SINTÉTICOS:
# =========================================================
# Para PainX/GainX: 1 punto = 1.0 en el precio (NO confundir con pips de Forex)
#
# Ejemplos prácticos:
# - FIXED_STOP_LOSS_POINTS=50    → 50.0 de distancia (Entry ± 50.0 = SL)
# - FIXED_STOP_LOSS_POINTS=900   → 900.0 de distancia (Entry ± 900.0 = SL)
# - FIXED_STOP_LOSS_POINTS=9000  → 9000.0 de distancia (Entry ± 9000.0 = SL)
#
# Ejemplo con Entry=112000 y SL=9000pts:
#   → BUY:  Entry=112000, SL=103000 (112000-9000), TP=121000 (112000+9000)
#   → SELL: Entry=112000, SL=121000 (112000+9000), TP=103000 (112000-9000)
#
# Valores recomendados para empezar:
#   PainX/GainX 400-800: SL=50-150pts, TP1=100-300pts
#   PainX/GainX 999-1200: SL=100-300pts, TP1=200-600pts
#
# ENABLE_DYNAMIC_RISK=false
# FIXED_STOP_LOSS_POINTS=50.0
# FIXED_TAKE_PROFIT_1_POINTS=125.0
# FIXED_TAKE_PROFIT_2_POINTS=250.0

# Selección de Take Profit para órdenes ejecutadas en MT5
# Valores válidos: "TP1" o "TP2"
# TP1 = Take Profit más conservador (menor distancia)
# TP2 = Take Profit más ambicioso (mayor distancia)
USE_TAKE_PROFIT=TP2

# Reglas específicas para índices sintéticos
# GainX solo señales BUY, PainX solo señales SELL
ENFORCE_GAINX_BUY_ONLY=true
ENFORCE_PAINX_SELL_ONLY=true

# ==================== GESTIÓN DE TRADES ABIERTOS ====================

# --- BREAK EVEN (Mover SL a punto de equilibrio) ---
ENABLE_BREAK_EVEN=true

# Modo Dinámico (solo si ENABLE_DYNAMIC_RISK=true): Valores en multiplicadores de ATR
BREAK_EVEN_TRIGGER_ATR_MULTIPLIER=1.0
BREAK_EVEN_PROFIT_LOCK_ATR_MULTIPLIER=0.2

# Modo Fijo (solo si ENABLE_DYNAMIC_RISK=false): Valores en PUNTOS
# Para índices sintéticos: 1 punto = 1.0 en el precio
# Ejemplo: Trigger=150pts significa que cuando el precio se mueva 150.0 a favor, activa BE
# FIXED_BREAK_EVEN_TRIGGER_POINTS=15.0
# FIXED_BREAK_EVEN_PROFIT_LOCK_POINTS=3.0

# --- TRAILING STOP (SL dinámico que sigue el precio) ---
ENABLE_TRAILING_STOP=true

# Modo Dinámico (solo si ENABLE_DYNAMIC_RISK=true): Valores en multiplicadores de ATR
TRAILING_STOP_TRIGGER_ATR_MULTIPLIER=2.0
TRAILING_STOP_DISTANCE_ATR_MULTIPLIER=1.5

# Modo Fijo (solo si ENABLE_DYNAMIC_RISK=false): Valores en PUNTOS
# Para índices sintéticos: 1 punto = 1.0 en el precio
# Ejemplo: Trigger=300pts significa que cuando el precio se mueva 300.0 a favor, activa TS
# FIXED_TRAILING_STOP_TRIGGER_POINTS=30.0
# FIXED_TRAILING_STOP_DISTANCE_POINTS=22.5

# ==================== LOTAJE DINÁMICO ====================
# Ajustar tamaño de lote según confianza de la señal
ENABLE_DYNAMIC_LOT_SIZE=true
MIN_LOT_SIZE=0.10
MAX_LOT_SIZE=1.00
# El lotaje se escalará linealmente entre MIN y MAX basado en la confianza de la señal
# (desde CONFIDENCE_THRESHOLD hasta 1.0)

# ==================== REENTRENAMIENTO AUTOMÁTICO ====================
# Reentrenar modelos automáticamente cuando estén desactualizados
ENABLE_AUTO_RETRAIN=true

# Edad máxima de los modelos en días (si son más viejos, se reentrenarán automáticamente)
AUTO_RETRAIN_DAYS=7

# Número de velas a descargar desde MT5 para reentrenar
# Valores recomendados: 10000-20000 velas para mejor calidad del modelo LSTM
# NOTA: Activos nuevos (<2 años) en timeframes altos (4h, 1d) pueden tener menos datos disponibles
RETRAIN_CANDLES=10000

# Directorio donde se guardan/cargan los modelos
MODELS_DIRECTORY=models

# ==================== LOGGING ====================
# Nivel de logging: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Archivo de log (ruta relativa desde la raíz del proyecto)
LOG_FILE=logs/trading_bot.log

# ==================== FILTROS AVANZADOS ====================
# Estos filtros ayudan a mejorar la rentabilidad reduciendo señales de baja calidad
# que podrían resultar en pérdidas consecutivas o divergencias de mercado.

# --- Activación de Filtros (true/false) ---
# Puedes activar o desactivar cada filtro individualmente según tus pruebas

# Filtro de Divergencias: Bloquea señales cuando RSI está sobre-comprado/sobre-vendido
# pero el momentum del precio va en dirección opuesta (divergencia).
# Ejemplo: RSI > 70 (sobre-compra) pero el precio sigue subiendo fuertemente = Divergencia
ENABLE_DIVERGENCE_FILTER=true

# Filtro de Pérdidas Consecutivas: Después de N pérdidas consecutivas en un símbolo,
# activa un período de enfriamiento (cooldown) antes de permitir nuevas señales.
# Evita abrir 3-4 operaciones seguidas que todas terminan en SL.
ENABLE_CONSECUTIVE_LOSSES_FILTER=true

# Filtro de Tendencia Mejorado: Solo permite señales cuando hay una tendencia clara
# medida por ADX y alineación de EMAs. Evita señales en mercados laterales/choppy.
ENABLE_ENHANCED_TREND_FILTER=true

# Filtro de Momentum: Bloquea señales contra-tendencia cuando el precio tiene
# un momentum muy fuerte en la dirección opuesta.
# Ejemplo: Señal SELL cuando el precio está subiendo > 2%
ENABLE_MOMENTUM_FILTER=true

# Filtro de Proximidad a Soporte/Resistencia con DETECCIÓN DE REACCIÓN:
# No solo verifica que el precio esté cerca de S/R, sino que REQUIERE que el precio
# haya REACCIONADO a esos niveles (con patrones de velas de rechazo confirmados).
#
# El bot ahora espera a:
#   1. Que el precio toque el nivel S/R (dentro de tolerancia)
#   2. Que haya un patrón de rechazo (Hammer, Shooting Star, Engulfing, etc.)
#   3. Que haya confirmación (el precio se aleja del nivel)
#
# Esto mejora dramáticamente la calidad de las operaciones al solo operar en reacciones
# confirmadas en lugar de "en medio de la nada".
ENABLE_SR_PROXIMITY_FILTER=true

# --- Parámetros del Filtro de Pérdidas Consecutivas ---
# Máximo de pérdidas (SL) consecutivas antes de activar el cooldown
# Recomendado: 2-3 para índices sintéticos
MAX_CONSECUTIVE_LOSSES=2

# Horas de espera (cooldown) después de alcanzar el máximo de pérdidas consecutivas
# Durante este tiempo, NO se generarán señales para ese símbolo
# Recomendado: 2-4 horas
COOLDOWN_HOURS=2.0

# --- Parámetros del Filtro de Tendencia Mejorado ---
# ADX mínimo para considerar que existe una tendencia
# ADX < 25 = Mercado lateral (no hay tendencia clara)
# ADX >= 25 = Tendencia presente
# Recomendado: 25-30
MIN_ADX_FOR_TREND=25.0

# Requiere que las EMAs estén alineadas con la dirección de la señal
# true = Solo permite BUY si EMA9 > EMA21 > SMA50, y SELL si lo opuesto
# false = Ignora alineación de EMAs
EMA_ALIGNMENT_REQUIRED=true

# Máximo porcentaje de desviación del precio respecto a SMA50
# Evita señales cuando el precio está muy lejos de la media (sobre-extendido)
# Recomendado: 2.0-5.0 (%)
MAX_PERCENT_FROM_SMA50=3.0

# --- Parámetros del Filtro de Momentum ---
# Máximo momentum permitido en contra de la señal (en porcentaje)
# Ejemplo: Si señal es SELL pero el precio subió > 2% recientemente, se bloquea
# Recomendado: 1.5-3.0 (%)
MAX_MOMENTUM_PERCENT=2.0

# --- Parámetros del Filtro de Soporte/Resistencia + Detección de Reacción ---
# Proximidad/Tolerancia para S/R y detección de reacciones (en %)
# Ejemplo: 0.5% = El precio debe tocar el nivel S/R dentro del 0.5% de tolerancia
# para considerar que hubo un toque válido y buscar patrones de reacción
# Valores más pequeños = más estricto (solo reacciones muy precisas en el nivel)
# Valores más grandes = más flexible (acepta reacciones cerca del nivel)
# Recomendado: 0.3-0.5 (%) para índices sintéticos
# OPCIÓN 2 (Conservadora): 1.0% para más flexibilidad en detección de toques
SR_PROXIMITY_PERCENT=1.0

# Distancia máxima permitida desde S/R (en %)
# Si el precio está más lejos que este valor, la señal se bloquea
# Recomendado: 1.0-2.0 (%)
SR_MAX_DISTANCE_PERCENT=1.5

# --- Parámetros del Filtro de Divergencias ---
# Umbral de RSI para considerar sobre-compra (para señales SELL)
# Recomendado: 65-75
DIVERGENCE_RSI_OVERBOUGHT=70.0

# Umbral de RSI para considerar sobre-venta (para señales BUY)
# Recomendado: 25-35
DIVERGENCE_RSI_OVERSOLD=30.0

# Umbral de momentum para detectar divergencias (en %)
# Si el precio se mueve más de este % en dirección opuesta al RSI, es divergencia
# Recomendado: 1.0-2.0 (%)
DIVERGENCE_MOMENTUM_THRESHOLD=1.5
